{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "use-capital-pool-data",
  "type": "registry:hook",
  "title": "useCapitalPoolData",
  "description": "Hook for fetching capital pool data",
  "dependencies": [
    "wagmi"
  ],
  "registryDependencies": [
    "contracts"
  ],
  "files": [
    {
      "path": "registry/new-york/hooks/use-capital-pool-data/use-capital-pool-data.ts",
      "content": "\"use client\";\n\nimport { useCallback, useEffect, useMemo, useState } from \"react\";\nimport { useAccount } from \"wagmi\";\nimport {\n  MAINNET_CONTRACTS,\n  getChainConfig,\n  formatTokenAmount,\n  formatPercentage,\n} from \"@morpheus-ui/registry\";\n\ninterface CapitalPoolData {\n  totalStaked: bigint;\n  totalRewards: bigint;\n  currentApr: number;\n  userStaked: bigint;\n  userRewards: bigint;\n  epochNumber: number;\n  epochEndTime: Date;\n}\n\ninterface UseCapitalPoolDataOptions {\n  chainId?: number;\n  pollInterval?: number;\n  enabled?: boolean;\n}\n\nconst CAPITAL_POOL_ABI = [\n  {\n    inputs: [],\n    name: \"totalSupply\",\n    outputs: [{ name: \"\", type: \"uint256\" }],\n    stateMutability: \"view\",\n    type: \"function\",\n  },\n  {\n    inputs: [{ name: \"account\", type: \"address\" }],\n    name: \"balanceOf\",\n    outputs: [{ name: \"\", type: \"uint256\" }],\n    stateMutability: \"view\",\n    type: \"function\",\n  },\n  {\n    inputs: [],\n    name: \"rewardRate\",\n    outputs: [{ name: \"\", type: \"uint256\" }],\n    stateMutability: \"view\",\n    type: \"function\",\n  },\n  {\n    inputs: [{ name: \"account\", type: \"address\" }],\n    name: \"earned\",\n    outputs: [{ name: \"\", type: \"uint256\" }],\n    stateMutability: \"view\",\n    type: \"function\",\n  },\n  {\n    inputs: [],\n    name: \"periodFinish\",\n    outputs: [{ name: \"\", type: \"uint256\" }],\n    stateMutability: \"view\",\n    type: \"function\",\n  },\n] as const;\n\nexport function useCapitalPoolData(options: UseCapitalPoolDataOptions = {}) {\n  const { chainId = 8453, pollInterval = 30000, enabled = true } = options;\n  const { address, isConnected } = useAccount();\n  const contracts =\n    MAINNET_CONTRACTS[chainId as keyof typeof MAINNET_CONTRACTS];\n\n  const [poolData, setPoolData] = useState<CapitalPoolData | null>(null);\n  const [lastUpdated, setLastUpdated] = useState<Date | null>(null);\n\n  const fetchPoolData = useCallback(async () => {\n    if (!address) return;\n\n    // Get RPC URL from chain config\n    const chainConfig = getChainConfig(chainId as 8453 | 42161 | 84532);\n    const rpcUrl = chainConfig?.rpcUrl || \"https://mainnet.base.org\";\n\n    try {\n      const responses = await Promise.all([\n        fetch(rpcUrl, {\n          method: \"POST\",\n          headers: { \"Content-Type\": \"application/json\" },\n          body: JSON.stringify({\n            jsonrpc: \"2.0\",\n            method: \"eth_call\",\n            params: [\n              {\n                to: contracts?.CapitalPool,\n                data: \"0x18160ddd\", // totalSupply()\n              },\n              \"latest\",\n            ],\n            id: 1,\n          }),\n        }),\n        fetch(rpcUrl, {\n          method: \"POST\",\n          headers: { \"Content-Type\": \"application/json\" },\n          body: JSON.stringify({\n            jsonrpc: \"2.0\",\n            method: \"eth_call\",\n            params: [\n              {\n                to: contracts?.CapitalPool,\n                data:\n                  \"0x70a08231000000000000000000000000\" +\n                  address.slice(2).padStart(64, \"0\"),\n              },\n              \"latest\",\n            ],\n            id: 2,\n          }),\n        }),\n        fetch(rpcUrl, {\n          method: \"POST\",\n          headers: { \"Content-Type\": \"application/json\" },\n          body: JSON.stringify({\n            jsonrpc: \"2.0\",\n            method: \"eth_call\",\n            params: [\n              {\n                to: contracts?.CapitalPool,\n                data:\n                  \"0x3e8dbfac000000000000000000000000\" +\n                  address.slice(2).padStart(64, \"0\"),\n              },\n              \"latest\",\n            ],\n            id: 3,\n          }),\n        }),\n      ]);\n\n      const [totalSupplyRes, userBalanceRes, userRewardsRes] = responses;\n      const totalSupplyData = await totalSupplyRes.json();\n      const userBalanceData = await userBalanceRes.json();\n      const userRewardsData = await userRewardsRes.json();\n\n      const totalStaked = BigInt(parseInt(totalSupplyData.result, 16) || \"0\");\n      const userStaked = BigInt(parseInt(userBalanceData.result, 16) || \"0\");\n      const userRewards = BigInt(parseInt(userRewardsData.result, 16) || \"0\");\n\n      // Calculate APR based on reward rate (simplified)\n      const currentApr = totalStaked > 0n ? 0.12 : 0; // 12% default APR\n\n      setPoolData({\n        totalStaked,\n        totalRewards: 0n,\n        currentApr,\n        userStaked,\n        userRewards,\n        epochNumber: 1,\n        epochEndTime: new Date(Date.now() + 24 * 60 * 60 * 1000),\n      });\n      setLastUpdated(new Date());\n    } catch (error) {\n      console.error(\"Failed to fetch capital pool data:\", error);\n    }\n  }, [address, chainId, contracts?.CapitalPool]);\n\n  // Set up polling\n  useEffect(() => {\n    if (!enabled || !isConnected) return;\n\n    fetchPoolData();\n\n    const intervalId = setInterval(fetchPoolData, pollInterval);\n\n    return () => clearInterval(intervalId);\n  }, [enabled, isConnected, pollInterval, fetchPoolData]);\n\n  const formattedTotalStaked = useMemo(() => {\n    return formatTokenAmount(poolData?.totalStaked || 0n, 18, 0);\n  }, [poolData?.totalStaked]);\n\n  const formattedUserStaked = useMemo(() => {\n    return formatTokenAmount(poolData?.userStaked || 0n, 18, 4);\n  }, [poolData?.userStaked]);\n\n  const formattedUserRewards = useMemo(() => {\n    return formatTokenAmount(poolData?.userRewards || 0n, 18, 4);\n  }, [poolData?.userRewards]);\n\n  const formattedApr = useMemo(() => {\n    return formatPercentage(poolData?.currentApr || 0);\n  }, [poolData?.currentApr]);\n\n  return {\n    poolData,\n    formattedTotalStaked,\n    formattedUserStaked,\n    formattedUserRewards,\n    formattedApr,\n    currentApr: poolData?.currentApr || 0,\n    refetch: fetchPoolData,\n    lastUpdated,\n    isLoading: !lastUpdated && isConnected,\n  };\n}\n",
      "type": "registry:hook"
    }
  ]
}